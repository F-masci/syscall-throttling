name: Build System Call Throttling Kernel Module

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Install Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential linux-headers-$(uname -r)

      - name: Setup build environment
        run: make setup

      - name: Compile dependency module
        run: |
          cd discover
          make

      - name: Compile main module
        run: |
          cd /
          make
          
      - name: Compile client
        run: |
          cd client
          make

      - name: Verify Artifacts exist
        run: |
          ls -l discover/*.ko
          ls -l out/*.ko
          ls -l client/client